// Google tag (gtag.js)
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-TX305753YW');

// –î–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä–æ–≤
const products = {
    1: {
        name: "–°–≤–∏—Ç—à–æ—Ç Hermes",
        price: 129,
        brand: "hermes",
        category: "—Å–≤–∏—Ç—à–æ—Ç—ã",
        features: [
            "–ú–∞—Ç–µ—Ä–∏–∞–ª: –ø—Ä–µ–º–∏–∞–ª—å–Ω—ã–π —Ö–ª–æ–ø–æ–∫",
            "–ö–∞—á–µ—Å—Ç–≤–æ 1:1",
            "–§–∏—Ä–º–µ–Ω–Ω–∞—è –±–∏—Ä–∫–∞ –∏ —É–ø–∞–∫–æ–≤–∫–∞",
            "–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã: S, M, L, XL"
        ],
        images: [
            "hermeshud1.jpg",
            "hermeshud2.jpg",
            "hermeshud3.jpg",
            "hermeshud4.jpg",
            "hermeshud5.jpg",
            "hermeshud6.jpg",
        ]
    },
    2: {
        name: "–°–≤–∏—Ç—à–æ—Ç Burberry",
        price: 114,
        brand: "burberry",
        category: "—Å–≤–∏—Ç—à–æ—Ç—ã",
        features: [
            "–ú–∞—Ç–µ—Ä–∏–∞–ª: –≤—ã—Å–æ–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ö–ª–æ–ø–æ–∫",
            "–£–∑–Ω–∞–≤–∞–µ–º—ã–π –∫–ª–µ—Ç—á–∞—Ç—ã–π —É–∑–æ—Ä",
            "–§–∏—Ä–º–µ–Ω–Ω–∞—è –±–∏—Ä–∫–∞",
            "–†–∞–∑–º–µ—Ä—ã: M, L"
        ],
        images: [
            "–°–í–ò–¢–®–û–¢–´ BURBERRY1.jpg",
            "–°–í–ò–¢–®–û–¢–´ BURBERRY2.jpg",
            "–°–í–ò–¢–®–û–¢–´ BURBERRY3.jpg",
            "–°–í–ò–¢–®–û–¢–´ BURBERRY4.jpg",
            "–°–í–ò–¢–®–û–¢–´ BURBERRY5.jpg",
            "–°–í–ò–¢–®–û–¢–´ BURBERRY6.jpg",
            "–°–í–ò–¢–®–û–¢–´ BURBERRY7.jpg"
        ]
    },
    3: {
        name: "–°–≤–∏—Ç—à–æ—Ç Lacoste",
        price: 89,
        brand: "lacoste",
        category: "—Å–≤–∏—Ç—à–æ—Ç—ã",
        features: [
            "–ú–∞—Ç–µ—Ä–∏–∞–ª: —Ö–ª–æ–ø–æ–∫ —Å –Ω–µ–±–æ–ª—å—à–∏–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º —ç–ª–∞—Å—Ç–∞–Ω–∞",
            "–§–∏—Ä–º–µ–Ω–Ω—ã–π –∫—Ä–æ–∫–æ–¥–∏–ª",
            "–ö–æ–º—Ñ–æ—Ä—Ç–Ω–∞—è –ø–æ—Å–∞–¥–∫–∞",
            "–†–∞–∑–º–µ—Ä—ã: M, L"
        ],
        images: [
            "–°–í–ò–¢–®–û–¢–´ LACOSTE–±–µ–ª1.jpg",
            "–°–í–ò–¢–®–û–¢–´ LACOSTE–±–µ–ª2.jpg",
            "–°–í–ò–¢–®–û–¢–´ LACOSTE–±–µ–ª3.jpg",
            "–°–í–ò–¢–®–û–¢–´ LACOSTE–±–µ–ª4.jpg",
            "–°–í–ò–¢–®–û–¢–´ LACOSTE–±–µ–ª5.jpg",
            "–°–í–ò–¢–®–û–¢–´ LACOSTE–±–µ–ª6.jpg",
            "–°–í–ò–¢–®–û–¢–´ LACOSTE–±–µ–ª7.jpg"
        ]
    },
    4: {
        name: "–°–≤–∏—Ç—à–æ—Ç Lacoste —á–µ—Ä–Ω—ã–π",
        price: 89,
        brand: "lacoste",
        category: "—Å–≤–∏—Ç—à–æ—Ç—ã",
        features: [
            "–ú–∞—Ç–µ—Ä–∏–∞–ª: –ø—Ä–µ–º–∏–∞–ª—å–Ω—ã–π —Ö–ª–æ–ø–æ–∫",
            "–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —á–µ—Ä–Ω—ã–π —Ü–≤–µ—Ç",
            "–§–∏—Ä–º–µ–Ω–Ω—ã–π –∫—Ä–æ–∫–æ–¥–∏–ª",
            "–†–∞–∑–º–µ—Ä—ã: S, M, L, XL"
        ],
        images: [
            "–°–í–ò–¢–®–û–¢–´ LACOSTE—á–µ—Ä1.jpg",
            "–°–í–ò–¢–®–û–¢–´ LACOSTE—á–µ—Ä2.jpg",
            "–°–í–ò–¢–®–û–¢–´ LACOSTE—á–µ—Ä3.jpg",
            "–°–í–ò–¢–®–û–¢–´ LACOSTE—á–µ—Ä4.jpg",
            "–°–í–ò–¢–®–û–¢–´ LACOSTE—á–µ—Ä5.jpg",
            "–°–í–ò–¢–®–û–¢–´ LACOSTE—á–µ—Ä6.jpg",
        ]
    },
    5: {
        name: "–ó–∏–ø–∫–∞ Dior",
        price: 149,
        brand: "dior",
        category: "–∑–∏–ø–∫–∏",
        features: [
            "–ú–∞—Ç–µ—Ä–∏–∞–ª: –≤—ã—Å–æ–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–æ–ª–∏—ç—Å—Ç–µ—Ä",
            "–§–∏—Ä–º–µ–Ω–Ω–∞—è —Ñ—É—Ä–Ω–∏—Ç—É—Ä–∞",
            "–ö–∞—á–µ—Å—Ç–≤–æ 1:1",
            "–†–∞–∑–º–µ—Ä—ã: M, L"
        ],
        images: [
            "DIOR–∑–∏–ø1.jpg",
            "DIOR–∑–∏–ø2.jpg",
            "DIOR–∑–∏–ø3.jpg",
            "DIOR–∑–∏–ø4.jpg",
            "DIOR–∑–∏–ø5.jpg",
            "DIOR–∑–∏–ø6.jpg",
            "DIOR–∑–∏–ø7.jpg",
            "DIOR–∑–∏–ø8.jpg",
            "DIOR–∑–∏–ø9.jpg"
        ]
    },
    6: {
        name: "–õ–æ–Ω–≥—Å–ª–∏–≤ Guess",
        price: 98,
        brand: "guess",
        category: "–ª–æ–Ω–≥—Å–ª–∏–≤—ã",
        features: [
            "–ú–∞—Ç–µ—Ä–∏–∞–ª: —Ö–ª–æ–ø–æ–∫",
            "–£–∑–Ω–∞–≤–∞–µ–º—ã–π –ª–æ–≥–æ—Ç–∏–ø Guess",
            "–£–¥–æ–±–Ω—ã–π –∫—Ä–æ–π",
            "–†–∞–∑–º–µ—Ä—ã: M, L"
        ],
        images: [
            "–õ–æ–Ω–≥guess1.jpg",
            "–õ–æ–Ω–≥guess2.jpg",
            "–õ–æ–Ω–≥guess3.jpg",
            "–õ–æ–Ω–≥guess4.jpg",
            "–õ–æ–Ω–≥guess5.jpg",
            "–õ–æ–Ω–≥guess6.jpg",
            "–õ–æ–Ω–≥guess7.jpg"
        ]
    },
    7: {
        name: "–ñ–∏–ª–µ—Ç–∫–∞ Corteiz",
        price: 139,
        brand: "corteiz",
        category: "–∂–∏–ª–µ—Ç–∫–∏",
        features: [
            "–ú–∞—Ç–µ—Ä–∏–∞–ª: –Ω–µ–π–ª–æ–Ω",
            "–í–æ–¥–æ–æ—Ç—Ç–∞–ª–∫–∏–≤–∞—é—â–∞—è –ø—Ä–æ–ø–∏—Ç–∫–∞",
            "–ù–µ—Å–∫–æ–ª—å–∫–æ –∫–∞—Ä–º–∞–Ω–æ–≤",
            "–†–∞–∑–º–µ—Ä—ã: M, L"
        ],
        images: [
            "photo_2025-07-01_17-31-38.jpg",
            "CORTEIZjil2.jpg",
            "CORTEIZjil3.jpg",
            "CORTEIZjil4.jpg",
            "CORTEIZjil5.jpg",
            "CORTEIZjil6.jpg",
            "CORTEIZjil7.jpg"
        ]
    },
    8: {
        name: "–ñ–∏–ª–µ—Ç–∫–∞ Jordan & Supreme",
        price: 169,
        brand: "jordan",
        category: "–∂–∏–ª–µ—Ç–∫–∏",
        features: [
            "–ú–∞—Ç–µ—Ä–∏–∞–ª: –ø–æ–ª–∏—ç—Å—Ç–µ—Ä",
            "–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –¥–∏–∑–∞–π–Ω –∫–æ–ª–ª–∞–±–æ—Ä–∞—Ü–∏–∏",
            "–§–∏—Ä–º–µ–Ω–Ω—ã–µ –ª–æ–≥–æ—Ç–∏–ø—ã",
            "–†–∞–∑–º–µ—Ä—ã: M, L"
        ],
        images: [
            "–ñ–ò–õ–ï–¢–ö–ò JORDAN & SUPREME–±–µ–ª1.jpg",
            "–ñ–ò–õ–ï–¢–ö–ò JORDAN & SUPREME–±–µ–ª2.jpg",
            "–ñ–ò–õ–ï–¢–ö–ò JORDAN & SUPREME–±–µ–ª3.jpg",
            "–ñ–ò–õ–ï–¢–ö–ò JORDAN & SUPREME–±–µ–ª4.jpg",
            "–ñ–ò–õ–ï–¢–ö–ò JORDAN & SUPREME–±–µ–ª5.jpg",
            "–ñ–ò–õ–ï–¢–ö–ò JORDAN & SUPREME–±–µ–ª6.jpg",
            "–ñ–ò–õ–ï–¢–ö–ò JORDAN & SUPREME–±–µ–ª7.jpg"
        ]
    },
    9: {
        name: "–ñ–∏–ª–µ—Ç–∫–∞ Nike ACG",
        price: 124,
        brand: "nike",
        category: "–∂–∏–ª–µ—Ç–∫–∏",
        features: [
            "–ú–∞—Ç–µ—Ä–∏–∞–ª: —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–Ω–∞—è —Ç–∫–∞–Ω—å Nike",
            "–í–æ–¥–æ–æ—Ç—Ç–∞–ª–∫–∏–≤–∞—é—â–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞",
            "–°–≤–µ—Ç–æ–æ—Ç—Ä–∞–∂–∞—é—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã",
            "–†–∞–∑–º–µ—Ä—ã: M, L"
        ],
        images: [
            "–ñ–ò–õ–ï–¢–ö–ò NIKEasg1.jpg",
            "–ñ–ò–õ–ï–¢–ö–ò NIKEasg2.jpg",
            "–ñ–ò–õ–ï–¢–ö–ò NIKEasg3.jpg",
            "–ñ–ò–õ–ï–¢–ö–ò NIKEasg4.jpg",
            "–ñ–ò–õ–ï–¢–ö–ò NIKEasg5.jpg",
            "–ñ–ò–õ–ï–¢–ö–ò NIKEasg6.jpg",
            "–ñ–ò–õ–ï–¢–ö–ò NIKEasg7.jpg"
        ]
    },
    10: {
        name: "–ñ–∏–ª–µ—Ç–∫–∞ Polo Ralph Lauren",
        price: 119,
        brand: "polo",
        category: "–∂–∏–ª–µ—Ç–∫–∏",
        features: [
            "–ú–∞—Ç–µ—Ä–∏–∞–ª: —Ö–ª–æ–ø–æ–∫/–Ω–µ–π–ª–æ–Ω",
            "–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –¥–∏–∑–∞–π–Ω",
            "–§–∏—Ä–º–µ–Ω–Ω—ã–π –ª–æ–≥–æ—Ç–∏–ø",
            "–†–∞–∑–º–µ—Ä—ã: S, M, L, XL"
        ],
        images: [
            "–ñ–ò–õ–ï–¢–ö–ò POLO RALPH LAUREN1.jpg",
            "–ñ–ò–õ–ï–¢–ö–ò POLO RALPH LAUREN2.jpg",
            "–ñ–ò–õ–ï–¢–ö–ò POLO RALPH LAUREN3.jpg",
            "–ñ–ò–õ–ï–¢–ö–ò POLO RALPH LAUREN4.jpg",
            "–ñ–ò–õ–ï–¢–ö–ò POLO RALPH LAUREN5.jpg",
            "–ñ–ò–õ–ï–¢–ö–ò POLO RALPH LAUREN6.jpg",
            "–ñ–ò–õ–ï–¢–ö–ò POLO RALPH LAUREN7.jpg",
            "–ñ–ò–õ–ï–¢–ö–ò POLO RALPH LAUREN8.jpg"
        ]
    },
    11: {
        name: "–ñ–∏–ª–µ—Ç–∫–∞ Prada",
        price: 189,
        brand: "prada",
        category: "–∂–∏–ª–µ—Ç–∫–∏",
        features: [
            "–ú–∞—Ç–µ—Ä–∏–∞–ª: –ø—Ä–µ–º–∏–∞–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã",
            "–ò–¥–µ–∞–ª—å–Ω–∞—è –ø–æ—Å–∞–¥–∫–∞",
            "–§–∏—Ä–º–µ–Ω–Ω–∞—è —Ñ—É—Ä–Ω–∏—Ç—É—Ä–∞",
            "–†–∞–∑–º–µ—Ä—ã: M, L"
        ],
        images: [
            "–ñ–ò–õ–ï–¢–ö–ò PRADA1.jpg",
            "–ñ–ò–õ–ï–¢–ö–ò PRADA2.jpg",
            "–ñ–ò–õ–ï–¢–ö–ò PRADA3.jpg",
            "–ñ–ò–õ–ï–¢–ö–ò PRADA4.jpg",
            "–ñ–ò–õ–ï–¢–ö–ò PRADA5.jpg",
            "–ñ–ò–õ–ï–¢–ö–ò PRADA6.jpg",
        ]
    }
};

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ—Ä–∑–∏–Ω—ã
let cart = JSON.parse(localStorage.getItem('cart')) || [];
let selectedSize = 'M';
let currentPage = 1;
const itemsPerPage = 8;
let filteredProducts = Object.values(products);

// DOM —ç–ª–µ–º–µ–Ω—Ç—ã
const cartCount = document.getElementById('cart-count');
const cartTotalPrice = document.getElementById('cart-total-price');
const cartContent = document.querySelector('.cart-content');
const cartSidebar = document.getElementById('cart-sidebar');
const overlay = document.getElementById('overlay');
const contactModal = document.getElementById('contact-modal');
const productDetailPage = document.getElementById('product-detail');
const toast = document.getElementById('toast');
const cartItemsContainer = document.getElementById('cart-items');
const cartEmpty = document.getElementById('cart-empty');
const productsGrid = document.getElementById('products-grid');
const priceRange = document.getElementById('price-range');
const priceValue = document.getElementById('price-value');
const brandFilter = document.getElementById('brand-filter');
const sizeFilter = document.getElementById('size-filter');
const sortFilter = document.getElementById('sort-filter');
const resetFilters = document.getElementById('reset-filters');
const pagination = document.getElementById('pagination');

// Lazy loading –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
function initLazyLoading() {
    const lazyImages = document.querySelectorAll('img[loading="lazy"]');

    if ('IntersectionObserver' in window) {
        const imageObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    img.src = img.dataset.src || img.src;
                    img.classList.remove('lazy');
                    imageObserver.unobserve(img);
                }
            });
        });

        lazyImages.forEach(img => {
            imageObserver.observe(img);
        });
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã
function updateCartCount() {
    cartCount.textContent = cart.length;
    cartCount.style.transform = 'scale(1.2)';
    setTimeout(() => {
        cartCount.style.transform = 'scale(1)';
    }, 300);
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—â–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏
function updateCartTotal() {
    const total = cart.reduce((sum, item) => sum + item.price, 0);
    cartTotalPrice.textContent = `${total.toLocaleString('ru-RU')} BYN`;
}

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ
function renderCartItems() {
    if (cart.length === 0) {
        cartEmpty.style.display = 'block';
        cartItemsContainer.innerHTML = '';
        return;
    }

    cartEmpty.style.display = 'none';
    cartItemsContainer.innerHTML = cart.map((item, index) => `
        <div class="cart-item">
            <img src="${item.image || 'https://via.placeholder.com/80'}" alt="${item.name}" loading="lazy">
            <div class="cart-item-info">
                <div class="cart-item-name">${item.name}</div>
                <div class="cart-item-price">${item.price.toLocaleString('ru-RU')} BYN</div>
                <small>–†–∞–∑–º–µ—Ä: ${item.size}</small>
            </div>
            <button class="remove-item" data-index="${index}">
                <i class="fas fa-times"></i>
            </button>
        </div>
    `).join('');

    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–Ω–æ–ø–æ–∫ —É–¥–∞–ª–µ–Ω–∏—è
    document.querySelectorAll('.remove-item').forEach(button => {
        button.addEventListener('click', (e) => {
            const index = parseInt(e.currentTarget.dataset.index);
            cart.splice(index, 1);
            localStorage.setItem('cart', JSON.stringify(cart));
            renderCartItems();
            updateCartCount();
            updateCartTotal();
            showToast('–¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã', 'success');
        });
    });
}

// –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
function showToast(message, type = 'success') {
    toast.textContent = message;
    toast.className = `toast ${type} show`;
    setTimeout(() => {
        toast.className = 'toast';
    }, 3000);
}

// –û—Ç–∫—Ä—ã—Ç—å –∫–æ—Ä–∑–∏–Ω—É
document.getElementById('cart-toggle').addEventListener('click', () => {
    cartSidebar.classList.add('open');
    overlay.classList.add('active');
    document.body.style.overflow = 'hidden';
});

// –ó–∞–∫—Ä—ã—Ç—å –∫–æ—Ä–∑–∏–Ω—É
document.getElementById('close-cart').addEventListener('click', closeCart);

function closeCart() {
    cartSidebar.classList.remove('open');
    overlay.classList.remove('active');
    document.body.style.overflow = '';
}

// –û—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
document.getElementById('contact-btn').addEventListener('click', () => {
    contactModal.classList.add('active');
    overlay.classList.add('active');
    document.body.style.overflow = 'hidden';
});

// –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
document.querySelectorAll('.close-modal').forEach(button => {
    button.addEventListener('click', () => {
        contactModal.classList.remove('active');
        overlay.classList.remove('active');
        document.body.style.overflow = '';
    });
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –æ–≤–µ—Ä–ª–µ—è
overlay.addEventListener('click', () => {
    cartSidebar.classList.remove('open');
    contactModal.classList.remove('active');
    overlay.classList.remove('active');
    document.body.style.overflow = '';
});

// –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É
function addToCartFromCard(productCard) {
    const productName = productCard.querySelector('h4').textContent;
    const productPrice = parseInt(productCard.querySelector('.price').textContent.replace(/\D/g, ''));
    const productImage = productCard.querySelector('img').src;

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ—Ç –ª–∏ —É–∂–µ —Ç–∞–∫–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω–µ
    if (cart.some(item => item.name === productName && item.size === selectedSize)) {
        showToast('–≠—Ç–æ—Ç —Ç–æ–≤–∞—Ä —É–∂–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ!', 'warning');
        return;
    }

    cart.push({
        name: productName,
        price: productPrice,
        size: selectedSize,
        image: productImage
    });

    localStorage.setItem('cart', JSON.stringify(cart));
    updateCartCount();
    updateCartTotal();
    renderCartItems();
    showToast('–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É!', 'success');

    // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
    if (typeof gtag !== 'undefined') {
        gtag('event', 'add_to_cart', {
            'items': [{
                'name': productName,
                'price': productPrice
            }]
        });
    }
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É
function initAddToCartButtons() {
    const buttons = document.querySelectorAll('.add-to-cart-btn');
    if (!buttons.length) return;

    buttons.forEach(button => {
        button.addEventListener('click', (e) => {
            const productCard = e.currentTarget.closest('.product-card');
            addToCartFromCard(productCard);

            // –ê–Ω–∏–º–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏
            const originalHtml = e.currentTarget.innerHTML;
            e.currentTarget.innerHTML = '<i class="fas fa-check"></i> –î–æ–±–∞–≤–ª–µ–Ω–æ';
            e.currentTarget.classList.add('added');
            setTimeout(() => {
                e.currentTarget.classList.remove('added');
                e.currentTarget.innerHTML = originalHtml;
            }, 2000);
        });
    });
}

// –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —Ç–æ–≤–∞—Ä–∞
function showProductDetail(productId) {
    const product = products[productId];
    if (!product) return;

    // –ó–∞–ø–æ–ª–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–≤–∞—Ä–µ
    document.getElementById('detail-product-name').textContent = product.name;
    document.getElementById('detail-product-price').textContent = `${product.price.toLocaleString('ru-RU')} BYN`;
    document.getElementById('detail-product-desc').textContent = `${product.name} - –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —Ä–µ–ø–ª–∏–∫–∞ 1:1 –æ—Ç –±—Ä–µ–Ω–¥–∞ ${product.brand}.`;

    // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
    const featuresList = document.getElementById('detail-features');
    featuresList.innerHTML = product.features.map(feature =>
        `<li>${feature}</li>`
    ).join('');

    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    const mainImage = document.getElementById('main-product-image');
    const thumbnailsContainer = document.querySelector('.product-thumbnails');

    if (product.images && product.images.length > 0) {
        mainImage.src = product.images[0];
        thumbnailsContainer.innerHTML = '';

        product.images.forEach((imageSrc, index) => {
            const thumbnail = document.createElement('img');
            thumbnail.className = 'thumbnail';
            thumbnail.alt = `Thumbnail ${index + 1}`;
            thumbnail.src = imageSrc;
            thumbnail.dataset.index = index;
            thumbnail.loading = 'lazy';

            thumbnail.addEventListener('click', () => {
                mainImage.src = imageSrc;
                document.querySelectorAll('.thumbnail').forEach(thumb => {
                    thumb.classList.remove('active');
                });
                thumbnail.classList.add('active');
            });

            if (index === 0) {
                thumbnail.classList.add('active');
            }

            thumbnailsContainer.appendChild(thumbnail);
        });
    }

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞
    productDetailPage.classList.add('active');
    document.body.style.overflow = 'hidden';

    // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
    if (typeof gtag !== 'undefined') {
        gtag('event', 'view_item', {
            'items': [{
                'item_name': product.name,
                'price': product.price
            }]
        });
    }
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
function initQuickViewButtons() {
    const buttons = document.querySelectorAll('.quick-view');
    if (!buttons.length) return;

    buttons.forEach(button => {
        button.addEventListener('click', (e) => {
            const productId = e.currentTarget.dataset.product;
            showProductDetail(productId);
        });
    });
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"
document.getElementById('back-to-products').addEventListener('click', () => {
    productDetailPage.classList.remove('active');
    document.body.style.overflow = '';
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ä–∞–∑–º–µ—Ä–∞
document.querySelectorAll('.size-option').forEach(option => {
    option.addEventListener('click', (e) => {
        // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —É –≤—Å–µ—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
        document.querySelectorAll('.size-option').forEach(opt => {
            opt.classList.remove('selected');
        });

        // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
        e.currentTarget.classList.add('selected');
        selectedSize = e.currentTarget.dataset.size;
    });
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞
document.getElementById('detail-add-to-cart').addEventListener('click', () => {
    const productName = document.getElementById('detail-product-name').textContent;
    const productPrice = parseInt(document.getElementById('detail-product-price').textContent.replace(/\D/g, ''));
    const productImage = document.getElementById('main-product-image').src;

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ—Ç –ª–∏ —É–∂–µ —Ç–∞–∫–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω–µ
    if (cart.some(item => item.name === productName && item.size === selectedSize)) {
        showToast('–≠—Ç–æ—Ç —Ç–æ–≤–∞—Ä —É–∂–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ!', 'warning');
        return;
    }

    cart.push({
        name: productName,
        price: productPrice,
        size: selectedSize,
        image: productImage
    });

    localStorage.setItem('cart', JSON.stringify(cart));
    updateCartCount();
    updateCartTotal();
    renderCartItems();
    showToast('–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É!', 'success');

    // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞
    productDetailPage.classList.remove('active');
    document.body.style.overflow = '';

    // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
    if (typeof gtag !== 'undefined') {
        gtag('event', 'add_to_cart', {
            'items': [{
                'name': productName,
                'price': productPrice
            }]
        });
    }
});

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ –∑–∞–∫–∞–∑–∞
function generateOrderText() {
    if (cart.length === 0) return '–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞';

    let orderText = 'üõí –î–ï–¢–ê–õ–ò –ó–ê–ö–ê–ó–ê üõí\n\n';
    orderText += 'üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ì–æ—Å—Ç—å\n\n';
    orderText += 'üì¶ –°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞:\n';

    cart.forEach((item, index) => {
        orderText += `‚Ä¢ ${item.name} (–†–∞–∑–º–µ—Ä: ${item.size}) - ${item.price.toLocaleString('ru-RU')} BYN\n`;
    });

    const total = cart.reduce((sum, item) => sum + item.price, 0);
    orderText += `\nüí∞ –ò—Ç–æ–≥–æ: ${total.toLocaleString('ru-RU')} BYN\n`;
    orderText += `\n‚è∞ –í—Ä–µ–º—è: ${new Date().toLocaleString('ru-RU')}`;
    orderText += `\n‚úÖ –í—Å–µ –±–∏—Ä–∫–∏ –∏ —è—Ä–ª—ã–∫–∏ –∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ`;
    orderText += `\n‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ 1:1`;
    orderText += `\n‚úÖ –ü–æ–ª–Ω–æ–µ –≤–∏–∑—É–∞–ª—å–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ`;

    return orderText;
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞
document.getElementById('order-btn').addEventListener('click', () => {
    if (cart.length === 0) {
        showToast('–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω—É', 'error');
        return;
    }

    const orderText = generateOrderText();
    const telegramUrl = `https://t.me/bigdigovich?text=${encodeURIComponent(orderText)}`;
    window.open(telegramUrl, '_blank');

    showToast('–û—Ç–∫—Ä—ã–≤–∞—é Telegram...', 'success');

    // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
    if (typeof gtag !== 'undefined') {
        gtag('event', 'purchase', {
            'transaction_id': Date.now().toString(),
            'value': cart.reduce((sum, item) => sum + item.price, 0),
            'currency': 'BYN',
            'items': cart.map(item => ({
                'item_name': item.name,
                'price': item.price,
                'quantity': 1
            }))
        });
    }

    // –û—á–∏—â–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
    setTimeout(() => {
        cart = [];
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartCount();
        updateCartTotal();
        renderCartItems();
        closeCart();
    }, 2000);
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞
document.getElementById('copy-order-btn').addEventListener('click', () => {
    if (cart.length === 0) {
        showToast('–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω—É', 'error');
        return;
    }

    const orderText = generateOrderText();
    navigator.clipboard.writeText(orderText).then(() => {
        showToast('–ó–∞–∫–∞–∑ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä!', 'success');
    }).catch(err => {
        showToast('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è', 'error');
    });
});

// –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
const categoriesContainer = document.querySelector('.categories');
const scrollLeftBtn = document.querySelector('.scroll-left');
const scrollRightBtn = document.querySelector('.scroll-right');

if (scrollLeftBtn && scrollRightBtn) {
    scrollLeftBtn.addEventListener('click', () => {
        categoriesContainer.scrollBy({ left: -200, behavior: 'smooth' });
    });

    scrollRightBtn.addEventListener('click', () => {
        categoriesContainer.scrollBy({ left: 200, behavior: 'smooth' });
    });
}

// –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
document.querySelectorAll('.category').forEach(category => {
    category.addEventListener('click', () => {
        const categoryName = category.dataset.category;
        filterProducts(categoryName);
    });
});

function filterProducts(category) {
    if (category === '–≤—Å–µ') {
        filteredProducts = Object.values(products);
    } else {
        filteredProducts = Object.values(products).filter(product =>
            product.category === category
        );
    }

    currentPage = 1;
    renderProducts();
    updatePagination();
}

// –§—É–Ω–∫—Ü–∏–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
function applyFilters() {
    const maxPrice = parseInt(priceRange.value);
    const brand = brandFilter.value;
    const size = sizeFilter.value;
    const sort = sortFilter.value;

    filteredProducts = Object.values(products).filter(product => {
        let pass = true;

        // –§–∏–ª—å—Ç—Ä –ø–æ —Ü–µ–Ω–µ
        if (product.price > maxPrice) {
            pass = false;
        }

        // –§–∏–ª—å—Ç—Ä –ø–æ –±—Ä–µ–Ω–¥—É
        if (brand !== 'all' && product.brand !== brand) {
            pass = false;
        }

        return pass;
    });

    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
    switch(sort) {
        case 'price-asc':
            filteredProducts.sort((a, b) => a.price - b.price);
            break;
        case 'price-desc':
            filteredProducts.sort((a, b) => b.price - a.price);
            break;
        case 'popular':
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏
            break;
        default:
            // newest - –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å
            break;
    }

    currentPage = 1;
    renderProducts();
    updatePagination();
}

// –†–µ–Ω–¥–µ—Ä —Ç–æ–≤–∞—Ä–æ–≤
function renderProducts() {
    console.log('Rendering products...');

    const start = (currentPage - 1) * itemsPerPage;
    const end = start + itemsPerPage;
    const productsToShow = filteredProducts.slice(start, end);

    productsGrid.innerHTML = productsToShow.map((product, index) => `
        <div class="product-card" data-id="${Object.keys(products).find(key => products[key] === product)}" data-category="${product.category}">
            <div class="product-image">
                <img src="${product.images[0]}" alt="${product.name}" loading="lazy">
                <div class="product-overlay">
                    <button class="quick-view" data-product="${Object.keys(products).find(key => products[key] === product)}">
                        –ë—ã—Å—Ç—Ä—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä
                    </button>
                </div>
            </div>
            <div class="product-info">
                <h4>${product.name}</h4>
                <p class="product-desc">–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —Ä–µ–ø–ª–∏–∫–∞ 1:1</p>
                <div class="product-footer">
                    <div class="price">${product.price} BYN</div>
                    <button class="add-to-cart-btn">
                        <i class="fas fa-shopping-cart"></i> –í –∫–æ—Ä–∑–∏–Ω—É
                    </button>
                </div>
            </div>
        </div>
    `).join('');

    initAddToCartButtons();
    initQuickViewButtons();
    initLazyLoading();
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
function updatePagination() {
    const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);

    if (totalPages <= 1) {
        pagination.style.display = 'none';
        return;
    }

    pagination.style.display = 'flex';
    let paginationHTML = '';

    for (let i = 1; i <= totalPages; i++) {
        if (i <= 3 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) {
            paginationHTML += `<button class="pagination-btn ${i === currentPage ? 'active' : ''}">${i}</button>`;
        } else if (i === currentPage - 2 || i === currentPage + 2) {
            paginationHTML += `<button class="pagination-btn">...</button>`;
        }
    }

    pagination.innerHTML = paginationHTML;

    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
    document.querySelectorAll('.pagination-btn').forEach((btn, index) => {
        btn.addEventListener('click', () => {
            if (btn.textContent === '...') return;

            currentPage = parseInt(btn.textContent);
            renderProducts();
            updatePagination();

            // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –≤–µ—Ä—Ö—É
            window.scrollTo({
                top: productsGrid.offsetTop - 100,
                behavior: 'smooth'
            });
        });
    });
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', () => {
    console.log('DOM loaded, initializing...');

    updateCartCount();
    renderCartItems();
    updateCartTotal();

    // –í—ã–±–∏—Ä–∞–µ–º —Ä–∞–∑–º–µ—Ä M –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    const defaultSize = document.querySelector('.size-option[data-size="M"]');
    if (defaultSize) {
        defaultSize.classList.add('selected');
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
    if (priceRange && priceValue) {
        priceRange.addEventListener('input', () => {
            priceValue.textContent = `–î–æ ${priceRange.value} BYN`;
            applyFilters();
        });
    }

    if (brandFilter) brandFilter.addEventListener('change', applyFilters);
    if (sizeFilter) sizeFilter.addEventListener('change', applyFilters);
    if (sortFilter) sortFilter.addEventListener('change', applyFilters);

    if (resetFilters) {
        resetFilters.addEventListener('click', () => {
            priceRange.value = 300;
            priceValue.textContent = '–î–æ 300 BYN';
            brandFilter.value = 'all';
            sizeFilter.value = 'all';
            sortFilter.value = 'newest';
            applyFilters();
        });
    }

    // –†–µ–Ω–¥–µ—Ä —Ç–æ–≤–∞—Ä–æ–≤
    setTimeout(() => {
        renderProducts();
        updatePagination();
    }, 100);

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
    initLazyLoading();

    // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–ª–æ–∞–¥–µ—Ä
    setTimeout(() => {
        const preloader = document.getElementById('preloader');
        if (preloader) {
            preloader.style.display = 'none';
        }
    }, 500);

    // Service Worker –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js')
            .then(() => console.log('SW registered'))
            .catch(err => console.log('SW registration failed:', err));
    }
});

// –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ LocalStorage
function cacheProducts() {
    localStorage.setItem('cached_products', JSON.stringify({
        data: products,
        timestamp: Date.now(),
        expires: Date.now() + (24 * 60 * 60 * 1000) // 24 —á–∞—Å–∞
    }));
}

function getCachedProducts() {
    const cached = localStorage.getItem('cached_products');
    if (!cached) return null;

    const { data, timestamp, expires } = JSON.parse(cached);

    if (Date.now() > expires) {
        localStorage.removeItem('cached_products');
        return null;
    }

    return data;
}